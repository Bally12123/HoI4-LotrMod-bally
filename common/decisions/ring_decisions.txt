################
##### DAG ######
################


ring_decisions = {
	test = {
        icon = GFX_decision_generic_civil_support
		cost = 0

        available = {
			always = yes
        }

        # NOTE: This checks EVERY STATE to show a decision on just ONE state.
        # TODO: Improve this crappy performance memery
        target_array = global.states
        state_target = yes
        days_remove = 0

        target_root_trigger = {
	        always = yes
	    }

        target_trigger = {
	        FROM = { state = global.fs_currentstate }
	    }

		visible = {
			always = yes
		}

		#fire_only_once = yes

		complete_effect = {
			set_variable = { ROOT.fs_max_casualty_rate = 1.0 }

			if = {
				limit = { has_country_flag = ring_details_view_open }
				clr_country_flag = ring_details_view_open
			}
			else = {
				set_country_flag = ring_details_view_open
			}
		}
	}

	int_form = {
        icon = GFX_decision_generic_civil_support
		cost = 0

        available = {
			always = yes
        }

        # NOTE: This checks EVERY STATE to show a decision on just ONE state.
        # TODO: Improve this crappy performance memery
        target_array = global.states
        state_target = yes
        days_remove = 0

        target_root_trigger = {
	        always = yes
	    }

        target_trigger = {
	        FROM = { state = global.fs_currentstate }
	    }

		visible = {
			always = yes
		}

		#fire_only_once = yes

		complete_effect = {
			if = {
				limit = { has_country_flag = ring_interception_form_open }
				clr_country_flag = ring_interception_form_open
			}
			else = {
				set_country_flag = ring_interception_form_open
			}
		}
	}

	test_setup = {
        icon = GFX_decision_generic_civil_support
		cost = 0

        available = {
			always = yes
        }

		visible = {
			always = yes
		}

		#fire_only_once = yes

		complete_effect = {
			SHI = {
				# set variables
				set_variable = { global.fs_currentstate = 144 }
				set_variable = { global.fs_steps = 1 }


				set_variable = { global.fs_days_left_in_state = 1000 }

				set_global_flag = fs_started

				# Initial fellowship
				FS_frodo = { ring_add_member_to_fellowship = yes }
				FS_sam = { ring_add_member_to_fellowship = yes }

				#ring_fellowship_begin_move_to_next_state = yes
			}

			#CAR = {
			#	CAR_roddac = {
			#		ring_add_member_to_hunting_party = yes
			#	}
			#	CAR_odbur = {
			#		ring_add_member_to_hunting_party = yes
			#	}
			#	CAR_heorfald = {
			#		ring_add_member_to_hunting_party = yes
			#	}
			#}
		}
	}

	# TODO: this should appear on all states we have prepared an ambush as well
	launch_interception_attempt = {
		icon = GFX_decision_generic_civil_support
		cost = 0

		targets = { global.fs_currentstate }
		state_target = yes
		selectable_mission = yes
		is_good = yes
		#days_mission_timeout = 10

		fixed_random_seed = no

		target_root_trigger = {
			has_global_flag = fs_started
		}

		target_trigger = {
			FROM = {
				state = global.fs_currentstate
			}
		}

		allowed = {
			# Northern wastes should not steal the ring
			NOT = { original_tag = NEP }
		}

		available = {
			always = yes
			#controls_state = global.fs_currentstate
			#check_variable = { global.fs_days_left_in_state > 14 }  # Need fellowship to stay for the duration of the mission
		}

		cancel_trigger = {
			NOT = { controls_state = global.fs_currentstate }
		}

		#timeout_effect = {
		#	ring_execute_interception_attempt = yes
		#}

		complete_effect = {
			#ring_execute_interception_attempt = yes
			#ring_interception_detection_check = yes
			CAR = {
				country_event = fs.19
			}
		}
	}
}
