
# This is being called every week (and possibly when a new advisor is hired)
# This is called for every country separately
# We call it from common/on_actions/...

lotr_advisors_update_vars_weekly = {

	# Last-minute-improviser
	if = {
		limit = { has_idea_with_trait = last_minute_improviser }
		set_variable = { ROOT.last_minute_improviser_bonus = ROOT.surrender_progress }
		multiply_variable = { var = ROOT.last_minute_improviser_bonus value = 0.2 }	# This bonus is 0-20 based on surrender limit
	}

	# Keeper of Knowledge
	if = {
		limit = { has_idea_with_trait = keeper_of_knowledge }
		set_variable = { ROOT.keeper_of_knowledge_bonus = ROOT.num_researched_technologies }
		multiply_variable = { var = ROOT.keeper_of_knowledge_bonus value = 0.0015 }	# Grants 0.15% for each researched tech
	}

	# Woodworking Enthusiast
	if = {
		limit = { has_idea_with_trait = woodworking_enthusiast }
		set_variable = { ROOT.woodworking_enthusiast_bonus = ROOT.resource@chromium }
		multiply_variable = { var = ROOT.woodworking_enthusiast_bonus value = 0.18 } # Grants 0.18% for each surplus of wood/chromium
		multiply_variable = { var = ROOT.woodworking_enthusiast_bonus value = 0.01 } # Giga-weirdness: When multiplying directly with 0.0018 it doesn't work.
		clamp_variable = { var = ROOT.woodworking_enthusiast_bonus max = 0.25 }
	}

	# Rare Mineral Researcher
	if = {
		limit = { has_idea_with_trait = rare_mineral_researcher }
		set_variable = { ROOT.rare_mineral_researcher_bonus = ROOT.resource@aluminium }
		multiply_variable = { var = ROOT.rare_mineral_researcher_bonus value = 0.5 } # Grants 0.5% for each surplus of mithril
		multiply_variable = { var = ROOT.rare_mineral_researcher_bonus value = 0.01 }
		clamp_variable = { var = ROOT.rare_mineral_researcher_bonus max = 0.15 }
	}

	# Valuable Luxury Crafter
	if = {
		limit = { has_idea_with_trait = valuable_luxury_crafter }
		set_variable = { ROOT.valuable_luxury_crafter_bonus = ROOT.resource@aluminium }
		multiply_variable = { var = ROOT.valuable_luxury_crafter_bonus value = -0.5 } # Grants -0.5% consumies for each surplus of mithril
		multiply_variable = { var = ROOT.valuable_luxury_crafter_bonus value = 0.01 }
		clamp_variable = { var = ROOT.valuable_luxury_crafter_bonus min = -0.25 }
	}

	# Chaos Enjoyer
	if = {
		limit = { has_idea_with_trait = chaos_enjoyer }
		set_variable = { ROOT.chaos_enjoyer_bonus = 1 }
		subtract_from_variable = { ROOT.chaos_enjoyer_bonus = ROOT.stability }
		multiply_variable = { var = ROOT.chaos_enjoyer_bonus value = 0.1 } # Grants up to 10% bonus based on how LOW the stability is
	}

	# Knowledge Collector
	if = {
		limit = { has_idea_with_trait = knowledge_collector }
		set_variable = { ROOT.knowledge_collector_bonus = num_subjects }
		multiply_variable = { var = ROOT.knowledge_collector_bonus value = 0.03 } # Grants up to 3% bonus for each subject
		clamp_variable = { var = ROOT.knowledge_collector_bonus max = 0.21 }
	}

	# Cadaver Experimenter
	if = {
		limit = { has_idea_with_trait = cadaver_experimenter }
		set_variable = { ROOT.cadaver_experimenter_bonus = casualties_k }
		multiply_variable = { var = ROOT.cadaver_experimenter_bonus value = 0.01 }
		multiply_variable = { var = ROOT.cadaver_experimenter_bonus value = 0.01 } # Grants 1% bonus for every 100k casualties
		clamp_variable = { var = ROOT.cadaver_experimenter_bonus max = 0.20 }
	}

	# Construction Coordinator
	if = {
		limit = { has_idea_with_trait = construction_coordinator }
		set_variable = { ROOT.construction_coordinator_bonus = 0 }
		for_each_scope_loop = {
		    array = ROOT.neighbors
		    if = {
		        limit = {
		        	has_government = revolutionary
		            exists = yes
		            NOT = { has_war_with = ROOT }
		        }
		        add_to_variable = { ROOT.construction_coordinator_bonus = 0.1 }
		    }
		}
		# Grants 10% bonus for each commie neighbour
		clamp_variable = { var = ROOT.construction_coordinator_bonus max = 0.30 }
	}

	# Full-Stomach Learner
	if = {
		limit = { has_idea_with_trait = full_stomach_learner }
		set_variable = { ROOT.full_stomach_learner_bonus = fuel_ratio }
		multiply_variable = { var = ROOT.full_stomach_learner_bonus value = 0.08 } # Gives 0-8% speed based on fuel stockpile
	}
}



# Some countries (Isengard / Angmar) switch from human to orc.
# You can use this effect to give them a couple of generic orc advisors.
lotr_advisors_add_generic_orc_advisors = {
	
	custom_effect_tooltip = lotr_advisors_add_generic_orc_advisors_tooltip

	set_country_flag = has_switched_to_orcs # This unlocks the researcher advisors (see ideas/zzz_lotr_advisors_orcs_switcheroo)

	# ISENGARD
	if = {
		limit = { original_tag = ISE }

		generate_character = {
		token_base = generic_orcs_enthusiastic_torturer
		advisor = {
			slot = spymaster
			cost = 150
			traits = { enthusiastic_torturer }
			available = {
				has_intelligence_agency = yes
			}
			ai_will_do = {
				factor = 1
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_27 }
		}
		}

		generate_character = {
		token_base = generic_orcs_daredevil
		advisor = {
			slot = spymaster
			cost = 150
			traits = { daredevil }
			available = {
				has_intelligence_agency = yes
			}
			ai_will_do = {
				factor = 1
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_53 }
		}
		}

		generate_character = {
		token_base = generic_orcs_investment_gambler
		advisor = {
			slot = treasurer
			cost = 150
			traits = { investment_gambler }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 0
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_12 }
		}
		}

		generate_character = {
		token_base = generic_orcs_backalley_dealer
		advisor = {
			slot = treasurer
			cost = 150
			traits = { backalley_dealer }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 1
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_18 }
		}
		}

		generate_character = {
		token_base = generic_orcs_ruthless_pillager
		advisor = {
			slot = treasurer
			cost = 150
			traits = { ruthless_pillager }
			available = {
				OR = {
					has_government = belligerent
					has_government = revolutionary
				}
			}
			ai_will_do = {
				factor = 1
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_2 }
		}
		}

		generate_character = {
		token_base = generic_orcs_inspiring_warrior
		advisor = {
			slot = political_advisor
			cost = 150
			traits = { inspiring_warrior }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 0
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_28 }
		}
		}

		generate_character = {
		token_base = generic_orcs_supply_appropriator
		advisor = {
			slot = political_advisor
			cost = 150
			traits = { supply_appropriator }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 1
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_11 }
		}
		}

		generate_character = {
		token_base = generic_orcs_gatherer_of_volunteers
		advisor = {
			slot = political_advisor
			cost = 150
			traits = { gatherer_of_volunteers }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 1
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_20 }
		}
		}

		generate_character = {
		token_base = generic_orcs_equipment_recycler
		advisor = {
			slot = political_advisor
			cost = 150
			traits = { equipment_recycler }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 1
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_13 }
		}
		}

		generate_character = {
		token_base = generic_orcs_mass_assault_expert
		advisor = {
			slot = theorist
			cost = 150
			traits = { mass_assault_expert }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 0
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_76 }
		}
		}

		generate_character = {
		token_base = generic_orcs_flogging_motivator
		advisor = {
			slot = army_chief 
			cost = 150
			traits = { flogging_motivator }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 0
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_3 }
		}
		}

		generate_character = {
		token_base = generic_orcs_meat_packer
		advisor = {
			slot = army_chief 
			cost = 150
			traits = { meat_packer }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 0
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_23 }
		}
		}

		generate_character = {
		token_base = generic_orcs_unrelenting_brawler
		advisor = {
			slot = high_command
			cost = 150
			traits = { unrelenting_brawler }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 0
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_8 }
		}
		}

		generate_character = {
		token_base = generic_orcs_talented_coordinator
		advisor = {
			slot = high_command
			cost = 150
			traits = { talented_coordinator }
			available = {
				always = yes
			}
			ai_will_do = {
				factor = 0
			}
		}
		portraits = {
			army = { small = GFX_idea_portrait_orcs_generic_26 }
		}
		}
	}

}
