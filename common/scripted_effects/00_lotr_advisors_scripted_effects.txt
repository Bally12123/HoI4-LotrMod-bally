
# This is being called every week (and possibly when a new advisor is hired)
# This is called for every country separately
# We call it from common/on_actions/...

lotr_advisors_update_vars_weekly = {

	# Last-minute-improviser
	if = {
		limit = { has_idea_with_trait = last_minute_improviser }
		set_variable = { ROOT.last_minute_improviser_bonus = ROOT.surrender_progress }
		multiply_variable = { var = ROOT.last_minute_improviser_bonus value = 0.2 }	# This bonus is 0-20 based on surrender limit
	}

	# Keeper of Knowledge
	if = {
		limit = { has_idea_with_trait = keeper_of_knowledge }
		set_variable = { ROOT.keeper_of_knowledge_bonus = ROOT.num_researched_technologies }
		multiply_variable = { var = ROOT.keeper_of_knowledge_bonus value = 0.0015 }	# Grants 0.15% for each researched tech
	}

	# Woodworking Enthusiast
	if = {
		limit = { has_idea_with_trait = woodworking_enthusiast }
		set_variable = { ROOT.woodworking_enthusiast_bonus = ROOT.resource@chromium }
		multiply_variable = { var = ROOT.woodworking_enthusiast_bonus value = 0.18 } # Grants 0.18% for each surplus of wood/chromium
		multiply_variable = { var = ROOT.woodworking_enthusiast_bonus value = 0.01 } # Giga-weirdness: When multiplying directly with 0.0018 it doesn't work.
		clamp_variable = { var = ROOT.woodworking_enthusiast_bonus max = 0.25 }
	}

	# Rare Mineral Researcher
	if = {
		limit = { has_idea_with_trait = rare_mineral_researcher }
		set_variable = { ROOT.rare_mineral_researcher_bonus = ROOT.resource@aluminium }
		multiply_variable = { var = ROOT.rare_mineral_researcher_bonus value = 0.5 } # Grants 0.5% for each surplus of mithril
		multiply_variable = { var = ROOT.rare_mineral_researcher_bonus value = 0.01 }
		clamp_variable = { var = ROOT.rare_mineral_researcher_bonus max = 0.15 }
	}

	# Valuable Luxury Crafter
	if = {
		limit = { has_idea_with_trait = valuable_luxury_crafter }
		set_variable = { ROOT.valuable_luxury_crafter_bonus = ROOT.resource@aluminium }
		multiply_variable = { var = ROOT.valuable_luxury_crafter_bonus value = -0.5 } # Grants -0.5% consumies for each surplus of mithril
		multiply_variable = { var = ROOT.valuable_luxury_crafter_bonus value = 0.01 }
		clamp_variable = { var = ROOT.valuable_luxury_crafter_bonus min = -0.25 }
	}
	
}
